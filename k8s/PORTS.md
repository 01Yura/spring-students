# Необходимые открытые порты для Kubernetes деплоя

## Для работы GitHub Actions workflow

### Мастер нода (76.64.94.54)

- **Порт 22 (SSH)** - TCP, входящий
  - Используется для подключения GitHub Actions к мастер ноде
  - Для копирования манифестов и выполнения kubectl команд
  - Должен быть доступен из интернета (для GitHub Actions runners)

## Для доступа к приложению

### Воркер ноды (IP адреса воркер нод)

- **Порт 30081 (NodePort)** - TCP, входящий
  - Используется для доступа к Spring Boot приложению извне
  - NodePort автоматически открывается на всех нодах кластера (мастер + воркеры)
  - Рекомендуется открывать только на воркер нодах для безопасности
  - Доступ: `http://<worker_node_ip>:30081`
  - Диапазон NodePort: 30000-32767

### Мастер нода (опционально)

- **Порт 30081 (NodePort)** - TCP, входящий
  - Технически NodePort открывается и на мастер ноде
  - Но обычно доступ к приложению идет через воркер ноды
  - Можно не открывать на мастер ноде для безопасности

## Для работы Kubernetes кластера (внутренние порты)

Эти порты обычно настраиваются автоматически при установке Kubernetes и должны быть открыты между нодами кластера:

### Мастер нода

- **6443** - Kubernetes API server
- **10250** - Kubelet API
- **10259** - kube-scheduler
- **10257** - kube-controller-manager
- **2379-2380** - etcd server client API (если etcd на мастер ноде)
- **6783** - Weave Net (если используется)
- **6784** - Weave Net (если используется)

### Воркер ноды

- **10250** - Kubelet API
- **30000-32767** - NodePort Services (включая наш 30081)
- **6783** - Weave Net (если используется)
- **6784** - Weave Net (если используется)

### Для сетевого плагина (зависит от используемого)

- **8472/UDP** - Flannel VXLAN
- **4789/UDP** - Flannel UDP
- **51820/UDP** - Calico BGP
- **179/TCP** - Calico BGP

## Итого: минимально необходимые порты для внешнего доступа

### Мастер нода:

- ✅ **22/TCP** (SSH) - для GitHub Actions workflow

### Воркер ноды:

- ✅ **30081/TCP** (NodePort) - для доступа к приложению

## Проверка открытых портов

### На мастер ноде:

```bash
# Проверить, слушает ли SSH
sudo netstat -tlnp | grep :22
# или
sudo ss -tlnp | grep :22
```

### На воркер нодах:

```bash
# Проверить, открыт ли NodePort
sudo netstat -tlnp | grep :30081
# или
sudo ss -tlnp | grep :30081
```

## Настройка firewall (Ubuntu 22.04)

### На мастер ноде:

```bash
sudo ufw allow 22/tcp comment 'SSH for GitHub Actions'
sudo ufw reload
```

### На воркер нодах:

```bash
sudo ufw allow 30081/tcp comment 'NodePort for Spring Students app'
sudo ufw reload
```

## Примечания

1. **SSH порт 22** на мастер ноде должен быть доступен из интернета для работы GitHub Actions
2. **NodePort 30081** на воркер нодах должен быть доступен для пользователей приложения
3. Внутренние порты Kubernetes обычно настраиваются автоматически при установке кластера
4. Если используется cloud provider (AWS, GCP, Azure), может потребоваться настройка Security Groups / Firewall Rules
